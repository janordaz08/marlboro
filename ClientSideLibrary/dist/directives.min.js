!function(){"use strict";angular.module("clientside.directives",[])}(),function(){"use strict";angular.module("clientside.directives").directive("loadingSpinner",function(){return{restrict:"EA",templateUrl:"ClientSideLibrary/dist/views/loading-spinner/loading-spinner.html",scope:{load:"="},link:function(e,i,t,o){}}})}(),function(){"use strict";function e(e,L){return{restrict:"EA",templateUrl:"ClientSideLibrary/dist/views/puzzle/puzzle.html",scope:{row:"=",col:"=",num:"=",img:"=",fnc:"=",enableSticky:"=",finishedCallback:"&"},link:function(n,e,i,t){n.fnc=n.fnc||{},n.currentPuzzle=0;var a,l,s,r,h,d,c,u,o,g,P,y=n.row,f=n.col,x="#EF001F";function z(){(s=new Image).addEventListener("load",m,!1),s.src="assets/images/puzzle/"+n.img[n.currentPuzzle]+".jpg",n.hasLevelStarted=!0,W()}function m(e){if(n.originalWidth=angular.copy(s.width),n.originalHeight=angular.copy(s.height),s.width>L.getWidth()){var i=L.getWidth()/s.width;s.width=L.getWidth(),s.height=s.height*i}s.width=.8*s.width,s.height=.8*s.height,n.originalToScaledWidthRatio=n.originalWidth/s.width,n.originalToScaledHeightRatio=n.originalHeight/s.height,n.originalPieceWidth=Math.floor(n.originalWidth/y),n.originalPieceHeight=Math.floor(n.originalHeight/f),c=Math.floor(s.width/y),u=Math.floor(s.height/f),h=c*y,d=u*f,a=document.getElementById("myCanvas"),l=a.getContext("2d"),a.width=h,a.height=d,a.style.border="1rem solid white",a.style.boxShadow="rgba(0, 0, 0, 0.25) 0px 1px 10px 4px",r=[],P={x:0,y:0},g=o=null,l.drawImage(s,0,0,h,d),function(){var e,i,t=0,o=0;for(e=0;e<y*f;e++)(i={}).sx=t,i.sy=o,r.push(i),h<=(t+=c)&&(t=0,o+=u),n.finishedPuzzleArray.push(i)}(),n.hasPuzzleLoaded=!0,W()}function v(){var e,i;r=function(e){for(var i,t,o=e.length;o;i=parseInt(Math.random()*o),t=e[--o],e[o]=e[i],e[i]=t);return e}(r),l.clearRect(0,0,h,d);var t=0,o=0;for(e=0;e<r.length;e++)(i=r[e]).xPos=t,i.yPos=o,l.drawImage(s,i.sx*n.originalToScaledWidthRatio,i.sy*n.originalToScaledHeightRatio,n.originalPieceWidth,n.originalPieceHeight,t,o,c,u),l.strokeRect(t,o,c,u),h<=(t+=c)&&(t=0,o+=u);a.onpointerdown=p,a.ontouchstart=p}function p(e){e.layerX||0==e.layerX?(P.x=e.layerX,P.y=e.layerY):(e.offsetX||0==e.offsetX)&&(P.x=e.offsetX,P.y=e.offsetY),null!=(o=function(){var e,i;for(e=0;e<r.length;e++)if(i=r[e],!(P.x<i.xPos||P.x>i.xPos+c||P.y<i.yPos||P.y>i.yPos+u))return n.enableSticky&&i.sx==i.xPos&&i.sy==i.yPos?null:i;return null}())&&(l.clearRect(o.xPos,o.yPos,c,u),l.save(),l.globalAlpha=.9,l.drawImage(s,o.sx*n.originalToScaledWidthRatio,o.sy*n.originalToScaledHeightRatio,n.originalPieceWidth,n.originalPieceHeight,P.x-c/2,P.y-u/2,c,u),l.restore(),document.onpointermove=S,document.onpointerup=w,document.ontouchmove=S,document.ontouchend=w)}function S(e){var i,t;for(g=null,e.layerX||0==e.layerX?(P.x=e.layerX,P.y=e.layerY):(e.offsetX||0==e.offsetX)&&(P.x=e.offsetX,P.y=e.offsetY),l.clearRect(0,0,h,d),i=0;i<r.length;i++)(t=r[i])!=o&&(l.drawImage(s,t.sx*n.originalToScaledWidthRatio,t.sy*n.originalToScaledHeightRatio,n.originalPieceWidth,n.originalPieceHeight,t.xPos,t.yPos,c,u),l.strokeRect(t.xPos,t.yPos,c,u),null==g&&(P.x<t.xPos||P.x>t.xPos+c||P.y<t.yPos||P.y>t.yPos+u||((g=t).sx!=g.xPos||g.sy!=g.yPos||!n.enableSticky&&g.sx==g.xPos&&g.sy==g.yPos)&&(l.save(),l.globalAlpha=.4,l.fillStyle=x,l.fillRect(g.xPos,g.yPos,c,u),l.restore())));l.save(),l.globalAlpha=.6,l.drawImage(s,o.sx*n.originalToScaledWidthRatio,o.sy*n.originalToScaledHeightRatio,n.originalPieceWidth,n.originalPieceHeight,P.x-c/2,P.y-u/2,c,u),l.restore(),l.strokeRect(P.x-c/2,P.y-u/2,c,u)}function w(e){if(document.onpointermove=null,document.onpointerup=null,document.ontouchmove=null,(document.ontouchend=null)!=g&&(g.sx!=g.xPos||g.sy!=g.yPos||!n.enableSticky&&g.sx==g.xPos&&g.sy==g.yPos)){var i={xPos:o.xPos,yPos:o.yPos};o.xPos=g.xPos,o.yPos=g.yPos,g.xPos=i.xPos,g.yPos=i.yPos}!function(){l.clearRect(0,0,h,d);var e,i,t=!0;for(e=0;e<r.length;e++)i=r[e],l.drawImage(s,i.sx*n.originalToScaledWidthRatio,i.sy*n.originalToScaledHeightRatio,n.originalPieceWidth,n.originalPieceHeight,i.xPos,i.yPos,c,u),n.enableSticky||l.strokeRect(i.xPos,i.yPos,c,u),i.xPos==i.sx&&i.yPos==i.sy||(l.strokeRect(i.xPos,i.yPos,c,u),t=!1);t&&setTimeout(R,100)}()}function R(){a.onpointerdown=null,document.onpointermove=null,document.onpointerup=null,a.ontouchstart=null,document.ontouchmove=null,document.ontouchend=null,n.finished(!0)}function W(){angular.extend(n.fnc,{showNext:n.showNext,start:n.start,finished:n.finished,hasLevelStarted:n.hasLevelStarted,hasLevelFinished:n.hasLevelFinished,hasPuzzleStarted:n.hasPuzzleStarted,hasPuzzleFinished:n.hasPuzzleFinished,hasPuzzleLoaded:n.hasPuzzleLoaded,currentPuzzle:n.currentPuzzle}),n.$evalAsync()}W(),n.finishedPuzzleArray=[],n.$onInit=z,n.hasLevelStarted=!1,n.hasLevelFinished=!1,n.hasPuzzleStarted=!1,n.hasPuzzleFinished=!1,n.$watchCollection("img",function(e,i){n.hasLevelStarted||z()}),n.finished=function(){n.hasPuzzleStarted=!1,n.hasPuzzleFinished=!0,W(),n.finishedCallback()},n.showNext=function(){n.currentPuzzle=n.currentPuzzle+1,n.hasPuzzleStarted=!1,n.hasPuzzleFinished=!1,n.hasPuzzleLoaded=!1,z()},n.start=function(){n.hasPuzzleFinished=!1,n.hasPuzzleStarted=!0,n.hasLevelStarted=!0,W(),v()}}}}angular.module("clientside.directives").directive("puzzle",e),e.$inject=["$window","appService"]}();